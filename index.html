<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.js"></script>
    <title>TOP</title>
</head>
<body>

<div id="root">
    <h1>parent</h1>
    <br>
    child call customStart times:{{customStart}}
    <br>
    <br>
    child call customParticipate times:{{customParticipate}}
    <br>
    <br>
    child call customEnd times:{{customEnd}}
    <br>
    <iframe src="child.html?promoId=88&lang=en" style="width: 320px; height: 400px;"></iframe>
</div>

    
<script>
    let messageTypes = Object.freeze({
        ORCHEXTRA_PROMOTOOL_START: 'orchextraPromotoolStart',
        ORCHEXTRA_PROMOTOOL_PARTICIPATE: 'orchextraPromotoolParticipate',
        ORCHEXTRA_PROMOTOOL_END: 'orchextraPromotoolEnd',
    })

    new Vue({
        el:'#root',
        data:{
            customStart:0,
            customParticipate:0,
            customEnd:0
        },
        methods: {
            performParticipation: function () {
                let participationStatusMock = {"status":true,"data":{"status":"winner","date":"1504177615944","voucher":"NOTEBOOK2E1","prizeId":1026}}
                return participationStatusMock.data
            }
        },
        created(){
            window.onmessage = (e) => {
                console.log(e.data.type)
                switch (e.data.type) {
                    case messageTypes.ORCHEXTRA_PROMOTOOL_START:
                        this.customStart++
                        break
                    case messageTypes.ORCHEXTRA_PROMOTOOL_PARTICIPATE:
                        this.customParticipate++
                        let participationStatus = this.performParticipation()
                        e.source.postMessage({type: 'orchextraPromotoolParticipation', data: participationStatus}, '*')
                        break
                    case messageTypes.ORCHEXTRA_PROMOTOOL_END:
                        this.customEnd++
                        break
                }
            }
        }
    })

</script>
</body>
</html>